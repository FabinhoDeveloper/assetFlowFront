<head>
  <style>
    body {
      min-height: 100vh;
      display: flex;
    }
    
    .sidebar {
      width: 280px;
      background-color: #212529;
      color: white;
      min-height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 100;
      transition: all 0.3s;
    }
    
    .sidebar-header {
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .sidebar-menu {
      padding: 0;
      list-style: none;
    }
    
    .sidebar-menu li {
      margin-bottom: 5px;
    }
    
    .sidebar-menu a {
      display: block;
      padding: 12px 20px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s;
    }
    
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .sidebar-menu i {
      margin-right: 10px;
    }
    
    .content {
      flex: 1;
      margin-left: 280px;
      padding: 20px;
      transition: all 0.3s;
    }
    
    .navbar {
      background-color: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .workspace-card {
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .workspace-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .btn-primary {
      background-color: #4a6bff;
      border-color: #4a6bff;
    }
    
    .btn-primary:hover {
      background-color: #2541b8;
      border-color: #2541b8;
    }
    
    @media (max-width: 768px) {
      .sidebar {
        margin-left: -280px;
      }
      .sidebar.active {
        margin-left: 0;
      }
      .content {
        margin-left: 0;
      }
      .content.active {
        margin-left: 280px;
      }
    }
  </style>
</head>

  <!-- Sidebar -->
<div class="sidebar" id="sidebar">
<div class="sidebar-header">
    <h3>AssetFlow</h3>
</div>
<ul class="sidebar-menu">
    <li>
    <a href="/workspaces" class="active">
        <i class="bi bi-grid-3x3-gap"></i> Workspaces
    </a>
    </li>
    <li>
    <a href="/profile">
        <i class="bi bi-person"></i> Profile
    </a>
    </li>
    <li>
    <li class="mt-5">
    <a href="/logout">
        <i class="bi bi-box-arrow-left"></i> Logout
    </a>
    </li>
</ul>
</div>

<!-- Content -->
<div class="content" id="content">
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light mb-4">
    <div class="container-fluid">
    <button class="btn btn-outline-secondary" id="sidebarToggle">
        <i class="bi bi-list">Menu</i>
    </button>
    <div class="ms-auto d-flex align-items-center">
        <div class="dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <span>{{firstName}}</span>
        </a>
        </div>
    </div>
    </div>
</nav>

<!-- Workspaces Content -->
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3">Workspaces</h1>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createWorkspaceModal">
        <i class="bi bi-plus-lg"></i> Create Workspace
    </button>
    </div>


    <div class="row">
    {{#each workspaces}}
      <div class="col-md-4 mb-4">
        <div class="card border-0 shadow-sm h-100 workspace-card" onclick="window.location.href='/workspace-items/{{this._id}}'">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="card-title mb-0">{{this.workspaceName}}</h5>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false" onclick="event.stopPropagation();">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="#"><i class="bi bi-pencil me-2"></i> Edit</a></li>
                  <li><a class="dropdown-item" href="#"><i class="bi bi-people me-2"></i> Share</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-trash me-2"></i> Delete</a></li>
                </ul>
              </div>
            </div>
            <p class="card-text text-muted">{{this.description}}</p>
          </div>
          <div class="card-footer bg-white border-top-0">
            <a href="/items/{{this.id}}" class="btn btn-sm btn-{{this.color}} w-100">View Items</a>
          </div>
        </div>
      </div>
    {{/each}}
</div>

    
</div>
</div>

<!-- Create Workspace Modal -->
<div class="modal fade" id="createWorkspaceModal" tabindex="-1" aria-labelledby="createWorkspaceModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="createWorkspaceModalLabel">Create New Workspace</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <form id="createWorkspaceForm">
        <div class="mb-3">
            <label for="workspaceName" class="form-label">Workspace Name</label>
            <input type="text" class="form-control" id="workspaceName" required>
        </div>
        <div class="mb-3">
            <label for="workspaceDescription" class="form-label">Description</label>
            <textarea class="form-control" id="workspaceDescription" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="workspaceColor" class="form-label">Color</label>
            <select class="form-select" id="workspaceColor">
            <option value="primary">Blue</option>
            <option value="success">Green</option>
            <option value="danger">Red</option>
            <option value="warning">Yellow</option>
            <option value="info">Cyan</option>
            <option value="secondary">Gray</option>
            </select>
        </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="createWorkspaceBtn">Create Workspace</button>
    </div>
    </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
// Toggle sidebar
document.getElementById('sidebarToggle').addEventListener('click', function() {
    document.getElementById('sidebar').classList.toggle('active');
    document.getElementById('content').classList.toggle('active');
});

// Create workspace request
const createWorkspaceBtn = document.getElementById('createWorkspaceBtn');
const createWorkspaceForm = document.getElementById('createWorkspaceForm');

createWorkspaceBtn.addEventListener('click', async () => {
  const workspaceName = createWorkspaceForm.workspaceName.value;
  const description = createWorkspaceForm.workspaceDescription.value;
  const color = createWorkspaceForm.workspaceColor.value;

  if (!workspaceName) {
    alert('Please enter a workspace name');
    return;
  }

  try {
    const res = await axios.post('/workspaces', { workspaceName, description, color });

    console.log(res.data)

    if (res.data.success) {
      // feedback e redirecionamento
        alert('Workspace criado com sucesso!');
        window.location.reload();
    } else {
      alert('Erro ao criar workspace.');
    }
  } catch (err) {
    alert(err.response?.data?.message || 'Erro ao criar workspace.');
  }
});

// Prevent card click when clicking dropdown
document.querySelectorAll('.dropdown-toggle').forEach(function(element) {
  element.addEventListener('click', function(e) {
    e.stopPropagation();
  });
});
</script>
